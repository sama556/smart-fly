<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking Confirmation - FlySmart</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;500;600;700&family=Segoe+UI:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="css/cart.css">
    <link rel="stylesheet" href="css/booking-confirmation.css">
    <link rel="stylesheet" href="css/notifications.css">
</head>
<body>
    <!-- Animated Background -->
    <div class="animated-bg" id="animatedBg"></div>

    <!-- Header -->
    <header id="header">
        <div class="container">
            <nav class="navbar">
                <a href="#home" class="logo">
                    <img src="./images/1.png" alt="FlySmart Logo">
                </a>
                
                <ul class="nav-links" id="navLinks">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="index.html#about">About</a></li>
                    <li><a href="index.html#features">Features</a></li>
                    <li><a href="airlines.html">Airlines</a></li>
                    <li><a href="index.html#deals">Deals</a></li> 
                    <li><a href ="bookings.html">Bookings</a>
                    <li><a href="index.html#contact">Contact</a></li>
                </ul>
                
                <div class="auth-buttons">
                    <div class="header-icons">
                        <div class="notification-icon" id="notificationIcon">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge" id="notificationBadge">0</span>
                        </div>
                        <div class="cart-icon" id="cartIcon">
                            <i class="fas fa-shopping-bag"></i>
                            <span class="cart-badge" id="cartBadge">0</span>
                        </div>
                        <div class="profile-icon" id="profileIcon">
                           <a href="profile.html" ><i class="fas fa-user"></i></a>
                        </div>
                    </div>
                    <button class="btn btn-primary" id="registerBtn"><a href="../login.html">sigin out </a></button>
                </div>
                
                <div class="menu-toggle" id="menuToggle">
                    <i class="fas fa-bars"></i>
                </div>
            </nav>
        </div>
    </header>

    <!-- Cart Dropdown -->
    <div class="cart-dropdown" id="cartDropdown">
        <div class="cart-header">
            <span>Your Bookings</span>
            <span id="cartItemCount">items</span>
        </div>
        <div id="cartList">
            <div class="empty-cart">
                <i class="fas fa-shopping-bag"></i>
                <p>Your cart is empty</p>
                <p style="font-size: 0.9rem; margin-top: 10px;">Add some flights to get started!</p>
            </div>
        </div>
        <div class="cart-footer" id="cartFooter" style="display: none;">
            <div class="cart-total">
                <span>Total:</span>
                <span id="cartTotal">0 SAR</span>
            </div>
            <button class="cart-checkout">
                <i class="fas fa-credit-card"></i> Continue Booking
            </button>
        </div>
    </div>

    <!-- Booking Confirmation Section -->
    <section class="booking-confirmation-section">
        <div class="container">
            <!-- Page Header -->
            <div class="page-header">
                <div class="page-title-section" id="paymentTitle">
                    <h1 class="page-title">
                        <i class="fas fa-credit-card"></i>
                        Complete Your Payment
                    </h1>
                    <p class="page-subtitle">Pay for your ticket securely to confirm your booking.</p>
                </div>
                <div class="page-title-section" id="confirmedTitle" style="display:none;">
                    <h1 class="page-title">
                        <i class="fas fa-rocket"></i>
                        Booking Confirmed!
                    </h1>
                    <p class="page-subtitle">Your flight has been successfully booked. You will receive a confirmation email shortly.</p>
                </div>
            </div>

            <!-- Confirmation Content -->
            <div class="confirmation-content">
                <!-- Payment Card (shown first) -->
                <div class="payment-card glass" id="paymentCard">
                    <div class="card-header">
                        <div class="header-content">
                            <h2><i class="fas fa-credit-card"></i> Payment</h2>
                            <p>Use your saved payment method to complete the purchase</p>
                        </div>
                    </div>
                    <div style="padding:16px;">
                        <div class="form-row">
                            <div class="form-group" style="width:100%">
                                <label>Amount (SAR)</label>
                                <input type="number" id="amountToPay" min="1" step="0.01" disabled>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group" style="width:100%">
                                <label for="confirmSelectCard">Select Card</label>
                                <select id="confirmSelectCard" required></select>
                                <div class="error-text" id="confirmCardError" style="display:none; margin-top:6px;"></div>
                            </div>
                        </div>
                        <div class="form-actions" style="display:flex; justify-content:flex-end; gap:10px;">
                            <button type="button" class="btn-cancel" onclick="window.location.href='airlines.html'">Cancel</button>
                            <button type="button" class="btn-save" id="payNowBtn"><i class="fas fa-lock"></i> Pay Now</button>
                        </div>
                    </div>
                </div>
                <!-- Success Message Card (hidden until paid) -->
                <div class="success-message-card glass" id="successMessageCard" style="display:none;">
                    <div class="success-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h2>Reservation Confirmed!</h2>
                    <p>Your flight booking has been successfully processed. All details are provided below.</p>
                </div>

                <!-- Reservation Details Card (hidden until paid) -->
                <div class="reservation-details-card glass" id="reservationDetailsCard" style="display:none;">
                    <div class="card-header">
                        <div class="header-content">
                            <h2><i class="fas fa-receipt"></i> Reservation Details</h2>
                            <p>Complete booking information and passenger details</p>
                        </div>
                        <div class="reservation-status">
                            <span class="status-badge confirmed">
                                <i class="fas fa-check-circle"></i>
                                Confirmed
                            </span>
                        </div>
                    </div>

                    <div class="reservation-info">
                        <div class="info-grid">
                            <div class="info-item">
                                <div class="info-label">
                                    <i class="fas fa-hashtag"></i>
                                    Reservation Number
                                </div>
                                <div class="info-value" id="reservationNumber">FLY-2024-001234</div>
                            </div>
                            
                           
                            
                            <div class="info-item">
                                <div class="info-label">
                                    <i class="fas fa-plane"></i>
                                    Flight Number
                                </div>
                                <div class="info-value" id="flightNumber">SV1234</div>
                            </div>
                            
                            <div class="info-item">
                                <div class="info-label">
                                    <i class="fas fa-calendar"></i>
                                    Booking Date
                                </div>
                                <div class="info-value" id="bookingDate">15 october 2025</div>
                            </div>
                            
                         
                        </div>
                    </div>
                </div>

                <!-- Passenger Information Card (hidden until paid) -->
                <div class="passenger-info-card glass" id="passengerInfoCard" style="display:none;">
                    <div class="card-header">
                        <div class="header-content">
                            <h2><i class="fas fa-users"></i> Passenger Information</h2>
                            <p>Passenger details and identification</p>
                        </div>
                    </div>

                    <div class="passenger-details">
                        <div class="passenger-main">
                            <div class="passenger-info">
                                <div class="passenger-name">
                                    <h3 id="passengerName">Ahmed Al-Rashid</h3>
                                    <span class="passenger-type">
                                        <i class="fas fa-user"></i>
                                        Primary Passenger
                                    </span>
                                </div>
                                
                            </div>
                            
                            <div class="qr-code-section">
                                <div class="qr-code">
                                    <div class="qr-placeholder">
                                        <i class="fas fa-qrcode"></i>
                                        <span>QR Code</span>
                                    </div>
                                </div>
                                <div class="qr-info">
                                    <p>Scan for boarding</p>
                                    <small>Valid until departure</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="booking-type-info">
                            <div class="booking-type">
                                <div class="type-label">Booking Type</div>
                                <div class="type-value">
                                    <span class="type-badge automatic">
                                        <i class="fas fa-robot"></i>
                                        Automatic
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

              >

                <!-- Seat Information Card -->
                <div class="seat-info-card glass">
                    <div class="card-header">
                        <div class="header-content">
                            <h2><i class="fas fa-chair"></i> Seat Information</h2>
                            <p>Your selected seat details</p>
                        </div>
                    </div>

                    <div class="seat-details">
                        <div class="seat-info">
                            <div class="seat-number" id="seatNumber">12A</div>
                            <div class="seat-description">
                                <div class="seat-row">Row 12</div>
                                <div class="seat-letter">Seat A</div>
                            </div>
                        </div>
                        <div class="seat-price">
                            <div class="price-label">Seat Price</div>
                            <div class="price-value">+50 SAR</div>
                        </div>
                    </div>
                </div>

                <!-- Receipt Card (hidden until paid) -->
                <div class="receipt-card glass" id="receiptCard" style="display:none; margin-top: 12px;">
                    <div class="card-header">
                        <div class="header-content">
                            <h2><i class="fas fa-receipt"></i> Payment Receipt</h2>
                            <p>Confirmation of your transaction</p>
                        </div>
                    </div>
                    <div class="reservation-info">
                        <div class="info-grid">
                            <div class="info-item">
                                <div class="info-label"><i class="fas fa-hashtag"></i> Transaction ID</div>
                                <div class="info-value" id="transactionId">-</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label"><i class="fas fa-credit-card"></i> Paid With</div>
                                <div class="info-value" id="paidCard">-</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label"><i class="fas fa-dollar-sign"></i> Amount Paid</div>
                                <div class="info-value amount" id="amountPaid">-</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label"><i class="fas fa-calendar-check"></i> Paid At</div>
                                <div class="info-value" id="paidAt">-</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>FlySmart</h3>
                    <p>Revolutionizing airline bookings with AI-driven insights for the best travel experiences. Your intelligent travel companion.</p>
                    
                </div>
                
                <div class="footer-column">
                    <h3>Quick Links</h3>
                    <ul class="footer-links">
                        <li><a href="index.html#home">Home</a></li>
                        <li><a href="index.html#about">About Us</a></li>
                        <li><a href="index.html#features">Features</a></li>
                        <li><a href="index.html#deals">Flight Deals</a></li>
                        <li><a href="index.html#contact">Contact Us</a></li>
                    </ul>
                </div>
              
              
            
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2025 FlySmart. All rights reserved</p>
            </div>
        </div>
    </footer>

 
    <script src="js/index.js"></script>
    <script src="js/cart.js"></script>
    <script src="js/booking-confirmation.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Pre-fill amount from Total Price if available
            const totalEl = document.getElementById('totalPrice');
            const amountInput = document.getElementById('amountToPay');
            if (totalEl && amountInput) {
                const match = (totalEl.textContent || '').match(/([0-9]+(?:\.[0-9]+)?)\s*S?A?R?/i);
                if (match) amountInput.value = match[1];
                else amountInput.value = '299';
            } else if (amountInput) {
                // Fallback if total price element is missing
                amountInput.value = '299';
            }

            // Populate saved cards for dropdown
            const confirmSelectCard = document.getElementById('confirmSelectCard');
            const confirmCardError = document.getElementById('confirmCardError');
            try {
                const savedCards = JSON.parse(localStorage.getItem('savedCards') || '[]');
                if (confirmSelectCard) {
                    confirmSelectCard.innerHTML = '<option value="" disabled selected>Select a card</option>';
                    if (Array.isArray(savedCards) && savedCards.length) {
                        savedCards.forEach(masked => {
                            const opt = document.createElement('option');
                            opt.value = masked;
                            opt.textContent = masked;
                            confirmSelectCard.appendChild(opt);
                        });
                    } else {
                        ['**** **** **** 1234','**** **** **** 5678'].forEach(masked => {
                            const opt = document.createElement('option');
                            opt.value = masked;
                            opt.textContent = masked;
                            confirmSelectCard.appendChild(opt);
                        });
                    }
                }
            } catch {}

            // One-click payment: require a selected card
            const payBtn = document.getElementById('payNowBtn');
            payBtn.addEventListener('click', function () {
                let amount = parseFloat(amountInput.value);
                if (isNaN(amount) || amount <= 0) {
                    amount = 299; // default fallback
                    if (amountInput) amountInput.value = String(amount);
                }
                if (confirmSelectCard && !confirmSelectCard.value) {
                    if (confirmCardError) {
                        confirmCardError.textContent = 'Please select a card.';
                        confirmCardError.style.display = 'block';
                    }
                    return;
                }
                payBtn.disabled = true;
                const original = payBtn.innerHTML;
                payBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';

                setTimeout(() => {
                    const maskedCard = (confirmSelectCard && confirmSelectCard.value) ? confirmSelectCard.value : '**** **** **** 1234';
                    const txEl = document.getElementById('transactionId');
                    if (txEl) txEl.textContent = 'TX-' + Math.random().toString(36).slice(2, 10).toUpperCase();
                    const paidCardEl = document.getElementById('paidCard');
                    if (paidCardEl) paidCardEl.textContent = maskedCard;
                    const amountPaidEl = document.getElementById('amountPaid');
                    if (amountPaidEl) amountPaidEl.textContent = amount.toFixed(2) + ' SAR';
                    const paidAtEl = document.getElementById('paidAt');
                    if (paidAtEl) paidAtEl.textContent = new Date().toLocaleString();

                    const setDisplay = (id, value) => {
                        const el = document.getElementById(id);
                        if (el) el.style.display = value;
                    };
                    setDisplay('paymentCard', 'none');
                    setDisplay('paymentTitle', 'none');
                    setDisplay('confirmedTitle', 'block');
                    setDisplay('successMessageCard', 'block');
                    setDisplay('reservationDetailsCard', 'block');
                    setDisplay('passengerInfoCard', 'block');
                    setDisplay('flightInfoCard', 'block');
                    setDisplay('receiptCard', 'block');
                }, 1000);
            });
        });
    </script>
</body>
</html>
